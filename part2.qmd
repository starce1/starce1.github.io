---
title: "Wisconsin Districts"
editor_options: 
  chunk_output_type: console
---

```{r}
#| message: false
#| include: false

library(fec12)
library(sf)        
library(ggspatial)
library(tidyverse)
library(ggplot2)
```


```{r}
#| message: false
#| include: false
district_elections <- results_house |>
  mutate(district = parse_number(district_id)) |>
  group_by(state, district) |>
  summarize(
    N = n(), 
    total_votes = sum(general_votes, na.rm = TRUE),
    d_votes = sum(ifelse(party == "D", general_votes, 0), na.rm = TRUE),
    r_votes = sum(ifelse(party == "R", general_votes, 0), na.rm = TRUE),
    .groups = "drop"
  ) |>
  mutate(
    other_votes = total_votes - d_votes - r_votes,
    r_prop = r_votes / total_votes,  
    winner = ifelse(r_votes > d_votes, "Republican", "Democrat")
  )
wi_results <- district_elections |>
  filter(state == "WI")
wi_results |>                  
  select(-state)
```

```{r}
#| message: false
#| include: false

src <- "http://cdmaps.polisci.ucla.edu/shp/districts113.zip"
lcl_zip <- fs::path(tempdir(), "districts113.zip")
download.file(src, destfile = lcl_zip)
lcl_districts <- fs::path(tempdir(), "districts113")
unzip(lcl_zip, exdir = lcl_districts)
dsn_districts <- fs::path(lcl_districts, "districtShapes")
st_layers(dsn_districts)
districts <- st_read(dsn_districts, layer = "districts113") |>
  mutate(DISTRICT = parse_number(as.character(DISTRICT)))
wi_shp <- districts |>
  filter(STATENAME == "Wisconsin")
wi_merged <- wi_shp |>
  st_transform(4326) |>
  inner_join(wi_results, by = c("DISTRICT" = "district"))

# Color based on winning party
#   Note that geom_sf is part of ggplot2 package, while st_geometry is
#   part of sf package
wi <- ggplot(data = wi_merged, aes(fill = winner)) +
  annotation_map_tile(zoom = 6, type = "osm", progress = "none") + 
  geom_sf(alpha = 0.5) +
  scale_fill_manual("Winner", values = c("blue", "red")) + 
  geom_sf_label(aes(label = DISTRICT), fill = "white") + 
  theme_void()

wi
```

```{r}
#| message: false
#| echo: false
#| warning: false

wi +
  aes(fill = r_prop) + 
  scale_fill_distiller(
    "Proportion\nRepublican", 
    palette = "RdBu", 
    limits = c(0.2, 0.8)
  )
```

This map represents the proportion of people who votes for republicans in 2012 (there seems to be missing data in fec16) in each Wisconsin district. The only two districts that ended up winning democrat are 2 and 3 which won by a lot since they are darker blues. There is evidence of gerrymandering in this map since some republican districts (especially 1, 7, and 8) were intentionally made to barely win republican so the state could come out that way overall.
